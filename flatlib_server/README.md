# Flatlib Natal Chart API

Локальный Home Assistant аддон, предоставляющий HTTP API для расчёта астрологических натальных карт и транзитов с использованием библиотеки Flatlib.

---

## Описание

Этот аддон запускает легковесный Flask-сервер, который служит бэкендом для астрологических расчётов. Он использует библиотеку `flatlib` для определения положений планет, домов, углов и аспектов на основе даты, времени и места рождения, а также для расчёта транзитов на заданную дату.

Предназначен для **интеграции с другими компонентами Home Assistant**, такими как автоматизации, сенсоры и скрипты, для создания персонализированных астрологических характеристик и предсказаний через LLM или другие средства. Все расчёты выполняются локально на вашем сервере Home Assistant, обеспечивая **конфиденциальность** ваших данных.

---

## Возможности

* **Расчёт натальной карты:** Получение положений планет, углов (Asc, MC), куспидов домов, лунных узлов, Лилит (Syzygy) и Парса Фортуны.
* **Расчёт натальных аспектов:** Определение аспектов между планетами в натальной карте.
* **Расчёт транзитов:** Определение аспектов текущих транзитных планет к натальным позициям для ежедневных, ежемесячных или ежегодных прогнозов.
* **JSON-вывод:** Данные предоставляются в удобном формате JSON, готовом для обработки в Home Assistant или передачи в LLM.

---

## Настройка

После установки аддона перейдите на вкладку **"Конфигурация"** в пользовательском интерфейсе аддона.

* **`log_level` (Уровень логирования):** Определяет детализацию логов аддона. Рекомендуется `info` для обычной работы. Для отладки используйте `debug`.

---

## Использование API

Аддон запускает Flask-сервер, доступный по адресу `http://a0d7b954-flatlib-server:8080` (это внутренний адрес Home Assistant Docker). Если вы хотите обращаться к API извне Home Assistant, вам нужно будет настроить перенаправление портов в конфигурации аддона.

### Основные эндпоинты:

* **`/natal` (POST):** Для расчёта натальной карты.
    * **Пример запроса:**
        ```json
        {
          "date": "1990-05-03",
          "time": "13:20:00",
          "tz": "+03:00",
          "lat": 56.2576,
          "lon": 43.9827
        }
        ```
* **`/transits` (POST):** Для расчёта транзитов текущих планет к натальной карте.
    * **Пример запроса:**
        ```json
        {
          "natal_date": "1990-05-03",
          "natal_time": "13:20:00",
          "natal_tz": "+03:00",
          "natal_lat": 56.2576,
          "natal_lon": 43.9827,
          "transit_date": "2025-07-14",
          "transit_time": "18:58:00",
          "transit_tz": "+03:00"
        }
        ```
* **`/health` (GET):** Проверка статуса работы API.
* **`/test` (GET):** Выполнение быстрого тестового расчёта.

Подробные примеры запросов и ответов для всех эндпоинтов доступны в основном [README репозитория](https://github.com/navi-vonamut/Flatlib-Natal-Chart-AP/blob/main/README.md).

---

## Поддержка и обратная связь

Если у вас возникнут вопросы или проблемы с использованием этого аддона, пожалуйста, создайте [Issue в основном репозитории GitHub](https://github.com/navi-vonamut/Flatlib-Natal-Chart-AP/issues).

---

## Лицензия

Этот аддон распространяется под лицензией [MIT License](LICENSE).